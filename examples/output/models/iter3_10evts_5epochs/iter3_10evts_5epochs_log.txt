/Users/ianwang/.virtualenvs/ChargedParticalTracking/bin/python /Users/ianwang/Desktop/AI-Physics(2021)/ChargedParticalTracking/examples/gnn.py
======Edge Network======
EdgeNetwork(
  (network): Sequential(
    (0): Linear(in_features=22, out_features=8, bias=True)
    (1): LayerNorm((8,), eps=1e-05, elementwise_affine=True)
    (2): ReLU()
    (3): Linear(in_features=8, out_features=1, bias=True)
    (4): Sigmoid()
  )
) 

======Node Network======
NodeNetwork(
  (network): Sequential(
    (0): Linear(in_features=33, out_features=8, bias=True)
    (1): LayerNorm((8,), eps=1e-05, elementwise_affine=True)
    (2): ReLU()
    (3): Linear(in_features=8, out_features=8, bias=True)
    (4): LayerNorm((8,), eps=1e-05, elementwise_affine=True)
    (5): ReLU()
  )
) 

Epoch 0
Reading output/pairs/100evts_volume8/event000001082-hits.csv...
Reading output/pairs/100evts_volume8/event000001082-pairs.csv...
Read complete. Loading graph...
Node count: 14496. Edge count: 59856
Graph loaded.
Process batch 0...
batch 0, loss 0.8544875979423523
Reading output/pairs/100evts_volume8/event000001035-hits.csv...
Reading output/pairs/100evts_volume8/event000001035-pairs.csv...
Read complete. Loading graph...
Node count: 15252. Edge count: 82558
Graph loaded.
Process batch 1...
batch 1, loss 0.8587954044342041
Reading output/pairs/100evts_volume8/event000001033-hits.csv...
Reading output/pairs/100evts_volume8/event000001033-pairs.csv...
Read complete. Loading graph...
Node count: 14906. Edge count: 59570
Graph loaded.
Process batch 2...
batch 2, loss 0.846493124961853
Reading output/pairs/100evts_volume8/event000001039-hits.csv...
Reading output/pairs/100evts_volume8/event000001039-pairs.csv...
Read complete. Loading graph...
Node count: 13443. Edge count: 49901
Graph loaded.
Process batch 3...
batch 3, loss 0.8290175199508667
Reading output/pairs/100evts_volume8/event000001062-hits.csv...
Reading output/pairs/100evts_volume8/event000001062-pairs.csv...
Read complete. Loading graph...
Node count: 10804. Edge count: 24363
Graph loaded.
Process batch 4...
batch 4, loss 0.7387095093727112
Reading output/pairs/100evts_volume8/event000001020-hits.csv...
Reading output/pairs/100evts_volume8/event000001020-pairs.csv...
Read complete. Loading graph...
Node count: 14815. Edge count: 77550
Graph loaded.
Process batch 5...
batch 5, loss 0.7973686456680298
Processed 6 batches in 925.5536930561066s
Training loss: 0.8208119670550028
Reading output/pairs/100evts_volume8/event000001044-hits.csv...
Reading output/pairs/100evts_volume8/event000001044-pairs.csv...
Read complete. Loading graph...
Node count: 15016. Edge count: 69140
Graph loaded.
Reading output/pairs/100evts_volume8/event000001057-hits.csv...
Reading output/pairs/100evts_volume8/event000001057-pairs.csv...
Read complete. Loading graph...
Node count: 15299. Edge count: 79963
Graph loaded.
Reading output/pairs/100evts_volume8/event000001067-hits.csv...
Reading output/pairs/100evts_volume8/event000001067-pairs.csv...
Read complete. Loading graph...
Node count: 14809. Edge count: 62911
Graph loaded.
Reading output/pairs/100evts_volume8/event000001001-hits.csv...
Reading output/pairs/100evts_volume8/event000001001-pairs.csv...
Read complete. Loading graph...
Node count: 14621. Edge count: 72321
Graph loaded.
Processed 284335 samples in 4 batches in 299.8983030319214s.
Validation loss: 0.7467647343873978 acc: 0.42337383719907856
Epoch 1
Reading output/pairs/100evts_volume8/event000001039-hits.csv...
Reading output/pairs/100evts_volume8/event000001039-pairs.csv...
Read complete. Loading graph...
Node count: 13443. Edge count: 49901
Graph loaded.
Process batch 0...
batch 0, loss 0.7531577348709106
Reading output/pairs/100evts_volume8/event000001033-hits.csv...
Reading output/pairs/100evts_volume8/event000001033-pairs.csv...
Read complete. Loading graph...
Node count: 14906. Edge count: 59570
Graph loaded.
Process batch 1...
batch 1, loss 0.7206853628158569
Reading output/pairs/100evts_volume8/event000001062-hits.csv...
Reading output/pairs/100evts_volume8/event000001062-pairs.csv...
Read complete. Loading graph...
Node count: 10804. Edge count: 24363
Graph loaded.
Process batch 2...
batch 2, loss 0.6662231683731079
Reading output/pairs/100evts_volume8/event000001020-hits.csv...
Reading output/pairs/100evts_volume8/event000001020-pairs.csv...
Read complete. Loading graph...
Node count: 14815. Edge count: 77550
Graph loaded.
Process batch 3...
batch 3, loss 0.6916418075561523
Reading output/pairs/100evts_volume8/event000001035-hits.csv...
Reading output/pairs/100evts_volume8/event000001035-pairs.csv...
Read complete. Loading graph...
Node count: 15252. Edge count: 82558
Graph loaded.
Process batch 4...
batch 4, loss 0.6372919082641602
Reading output/pairs/100evts_volume8/event000001082-hits.csv...
Reading output/pairs/100evts_volume8/event000001082-pairs.csv...
Read complete. Loading graph...
Node count: 14496. Edge count: 59856
Graph loaded.
Process batch 5...
batch 5, loss 0.597518801689148
Processed 6 batches in 944.8330421447754s
Training loss: 0.6777531305948893
Reading output/pairs/100evts_volume8/event000001057-hits.csv...
Reading output/pairs/100evts_volume8/event000001057-pairs.csv...
Read complete. Loading graph...
Node count: 15299. Edge count: 79963
Graph loaded.
Reading output/pairs/100evts_volume8/event000001001-hits.csv...
Reading output/pairs/100evts_volume8/event000001001-pairs.csv...
Read complete. Loading graph...
Node count: 14621. Edge count: 72321
Graph loaded.
Reading output/pairs/100evts_volume8/event000001067-hits.csv...
Reading output/pairs/100evts_volume8/event000001067-pairs.csv...
Read complete. Loading graph...
Node count: 14809. Edge count: 62911
Graph loaded.
Reading output/pairs/100evts_volume8/event000001044-hits.csv...
Reading output/pairs/100evts_volume8/event000001044-pairs.csv...
Read complete. Loading graph...
Node count: 15016. Edge count: 69140
Graph loaded.
Processed 284335 samples in 4 batches in 331.48295617103577s.
Validation loss: 0.6135160326957703 acc: 0.654671426310514
Epoch 2
Reading output/pairs/100evts_volume8/event000001062-hits.csv...
Reading output/pairs/100evts_volume8/event000001062-pairs.csv...
Read complete. Loading graph...
Node count: 10804. Edge count: 24363
Graph loaded.
Process batch 0...
batch 0, loss 0.6072684526443481
Reading output/pairs/100evts_volume8/event000001033-hits.csv...
Reading output/pairs/100evts_volume8/event000001033-pairs.csv...
Read complete. Loading graph...
Node count: 14906. Edge count: 59570
Graph loaded.
Process batch 1...
batch 1, loss 0.5996654033660889
Reading output/pairs/100evts_volume8/event000001039-hits.csv...
Reading output/pairs/100evts_volume8/event000001039-pairs.csv...
Read complete. Loading graph...
Node count: 13443. Edge count: 49901
Graph loaded.
Process batch 2...
batch 2, loss 0.5905506014823914
Reading output/pairs/100evts_volume8/event000001082-hits.csv...
Reading output/pairs/100evts_volume8/event000001082-pairs.csv...
Read complete. Loading graph...
Node count: 14496. Edge count: 59856
Graph loaded.
Process batch 3...
batch 3, loss 0.5325217247009277
Reading output/pairs/100evts_volume8/event000001035-hits.csv...
Reading output/pairs/100evts_volume8/event000001035-pairs.csv...
Read complete. Loading graph...
Node count: 15252. Edge count: 82558
Graph loaded.
Process batch 4...
batch 4, loss 0.5252304673194885
Reading output/pairs/100evts_volume8/event000001020-hits.csv...
Reading output/pairs/100evts_volume8/event000001020-pairs.csv...
Read complete. Loading graph...
Node count: 14815. Edge count: 77550
Graph loaded.
Process batch 5...
batch 5, loss 0.5344616770744324
Processed 6 batches in 984.0847170352936s
Training loss: 0.5649497210979462
Reading output/pairs/100evts_volume8/event000001001-hits.csv...
Reading output/pairs/100evts_volume8/event000001001-pairs.csv...
Read complete. Loading graph...
Node count: 14621. Edge count: 72321
Graph loaded.
Reading output/pairs/100evts_volume8/event000001057-hits.csv...
Reading output/pairs/100evts_volume8/event000001057-pairs.csv...
Read complete. Loading graph...
Node count: 15299. Edge count: 79963
Graph loaded.
Reading output/pairs/100evts_volume8/event000001067-hits.csv...
Reading output/pairs/100evts_volume8/event000001067-pairs.csv...
Read complete. Loading graph...
Node count: 14809. Edge count: 62911
Graph loaded.
Reading output/pairs/100evts_volume8/event000001044-hits.csv...
Reading output/pairs/100evts_volume8/event000001044-pairs.csv...
Read complete. Loading graph...
Node count: 15016. Edge count: 69140
Graph loaded.
Processed 284335 samples in 4 batches in 379.6645209789276s.
Validation loss: 0.5134101808071136 acc: 0.8673712346352014
Epoch 3
Reading output/pairs/100evts_volume8/event000001082-hits.csv...
Reading output/pairs/100evts_volume8/event000001082-pairs.csv...
Read complete. Loading graph...
Node count: 14496. Edge count: 59856
Graph loaded.
Process batch 0...
batch 0, loss 0.49157553911209106
Reading output/pairs/100evts_volume8/event000001020-hits.csv...
Reading output/pairs/100evts_volume8/event000001020-pairs.csv...
Read complete. Loading graph...
Node count: 14815. Edge count: 77550
Graph loaded.
Process batch 1...
batch 1, loss 0.5034971833229065
Reading output/pairs/100evts_volume8/event000001062-hits.csv...
Reading output/pairs/100evts_volume8/event000001062-pairs.csv...
Read complete. Loading graph...
Node count: 10804. Edge count: 24363
Graph loaded.
Process batch 2...
batch 2, loss 0.5265428423881531
Reading output/pairs/100evts_volume8/event000001035-hits.csv...
Reading output/pairs/100evts_volume8/event000001035-pairs.csv...
Read complete. Loading graph...
Node count: 15252. Edge count: 82558
Graph loaded.
Process batch 3...
batch 3, loss 0.4543169140815735
Reading output/pairs/100evts_volume8/event000001033-hits.csv...
Reading output/pairs/100evts_volume8/event000001033-pairs.csv...
Read complete. Loading graph...
Node count: 14906. Edge count: 59570
Graph loaded.
Process batch 4...
batch 4, loss 0.4775269329547882
Reading output/pairs/100evts_volume8/event000001039-hits.csv...
Reading output/pairs/100evts_volume8/event000001039-pairs.csv...
Read complete. Loading graph...
Node count: 13443. Edge count: 49901
Graph loaded.
Process batch 5...
batch 5, loss 0.4716811180114746
Processed 6 batches in 967.3163769245148s
Training loss: 0.4875234216451645
Reading output/pairs/100evts_volume8/event000001001-hits.csv...
Reading output/pairs/100evts_volume8/event000001001-pairs.csv...
Read complete. Loading graph...
Node count: 14621. Edge count: 72321
Graph loaded.
Reading output/pairs/100evts_volume8/event000001067-hits.csv...
Reading output/pairs/100evts_volume8/event000001067-pairs.csv...
Read complete. Loading graph...
Node count: 14809. Edge count: 62911
Graph loaded.
Reading output/pairs/100evts_volume8/event000001044-hits.csv...
Reading output/pairs/100evts_volume8/event000001044-pairs.csv...
Read complete. Loading graph...
Node count: 15016. Edge count: 69140
Graph loaded.
Reading output/pairs/100evts_volume8/event000001057-hits.csv...
Reading output/pairs/100evts_volume8/event000001057-pairs.csv...
Read complete. Loading graph...
Node count: 15299. Edge count: 79963
Graph loaded.
Processed 284335 samples in 4 batches in 296.8325068950653s.
Validation loss: 0.44220348447561264 acc: 0.9168586350607558
Epoch 4
Reading output/pairs/100evts_volume8/event000001020-hits.csv...
Reading output/pairs/100evts_volume8/event000001020-pairs.csv...
Read complete. Loading graph...
Node count: 14815. Edge count: 77550
Graph loaded.
Process batch 0...
batch 0, loss 0.43948864936828613
Reading output/pairs/100evts_volume8/event000001082-hits.csv...
Reading output/pairs/100evts_volume8/event000001082-pairs.csv...
Read complete. Loading graph...
Node count: 14496. Edge count: 59856
Graph loaded.
Process batch 1...
batch 1, loss 0.421608567237854
Reading output/pairs/100evts_volume8/event000001039-hits.csv...
Reading output/pairs/100evts_volume8/event000001039-pairs.csv...
Read complete. Loading graph...
Node count: 13443. Edge count: 49901
Graph loaded.
Process batch 2...
batch 2, loss 0.4429888427257538
Reading output/pairs/100evts_volume8/event000001062-hits.csv...
Reading output/pairs/100evts_volume8/event000001062-pairs.csv...
Read complete. Loading graph...
Node count: 10804. Edge count: 24363
Graph loaded.
Process batch 3...
batch 3, loss 0.48589426279067993
Reading output/pairs/100evts_volume8/event000001035-hits.csv...
Reading output/pairs/100evts_volume8/event000001035-pairs.csv...
Read complete. Loading graph...
Node count: 15252. Edge count: 82558
Graph loaded.
Process batch 4...
batch 4, loss 0.38600340485572815
Reading output/pairs/100evts_volume8/event000001033-hits.csv...
Reading output/pairs/100evts_volume8/event000001033-pairs.csv...
Read complete. Loading graph...
Node count: 14906. Edge count: 59570
Graph loaded.
Process batch 5...
batch 5, loss 0.4162050783634186
Processed 6 batches in 853.3092851638794s
Training loss: 0.43203146755695343
Reading output/pairs/100evts_volume8/event000001044-hits.csv...
Reading output/pairs/100evts_volume8/event000001044-pairs.csv...
Read complete. Loading graph...
Node count: 15016. Edge count: 69140
Graph loaded.
Reading output/pairs/100evts_volume8/event000001067-hits.csv...
Reading output/pairs/100evts_volume8/event000001067-pairs.csv...
Read complete. Loading graph...
Node count: 14809. Edge count: 62911
Graph loaded.
Reading output/pairs/100evts_volume8/event000001001-hits.csv...
Reading output/pairs/100evts_volume8/event000001001-pairs.csv...
Read complete. Loading graph...
Node count: 14621. Edge count: 72321
Graph loaded.
Reading output/pairs/100evts_volume8/event000001057-hits.csv...
Reading output/pairs/100evts_volume8/event000001057-pairs.csv...
Read complete. Loading graph...
Node count: 15299. Edge count: 79963
Graph loaded.
Processed 284335 samples in 4 batches in 296.4395709037781s.
Validation loss: 0.391425684094429 acc: 0.9194647159160849
Reading ../data/train_100_events/...
29172 hit record read: 
       hit_id         x         y  ...  layer_id  module_id  evtid
16873   16874  -32.5544  -3.64871  ...         2          1   1000
16874   16875  -33.1537  -1.93474  ...         2          1   1000
16875   16876  -26.3624 -18.42370  ...         2          2   1000
16876   16877  -12.0341 -29.64980  ...         2          3   1000
16877   16878  -15.1272 -28.15930  ...         2          3   1000
...       ...       ...       ...  ...       ...        ...    ...
46040   46041 -170.6030  26.20810  ...         8       1091   1000
46041   46042 -170.6070  26.37960  ...         8       1091   1000
46042   46043 -171.9050   9.85300  ...         8       1092   1000
46043   46044 -172.0160  10.96890  ...         8       1092   1000
46044   46045 -171.0240   1.04910  ...         8       1092   1000

[29172 rows x 8 columns] 

12263 particle record read: 
              particle_id          vx          vy  ...         pz  q  nhits
0        4503668346847232   -0.009288    0.009861  ...  -0.203492 -1      8
1        4503737066323968   -0.009288    0.009861  ...   2.010060  1     11
2        4503805785800704   -0.009288    0.009861  ...   0.683881 -1      0
3        4503874505277440   -0.009288    0.009861  ...   0.991616  1     12
4        4503943224754176   -0.009288    0.009861  ... -39.824900  1      3
...                   ...         ...         ...  ...        ... ..    ...
12258  968305530860736513 -171.641000  302.668000  ...  -0.137469  1      0
12259  968305530860740610 -171.641000  302.668000  ...  -0.248553  1      4
12260  968306149319245824   33.448100   20.703400  ...  -1.227300  1     10
12261  968306218038722560   33.448100   20.703400  ...  -0.415145 -1      1
12262  968307936025640960   -0.004181    0.004748  ...   0.057719  1      2

[12263 rows x 9 columns] 

120939 truth label read: 
        hit_id         particle_id  ...            tpz    weight
0            1                   0  ... -956385.000000  0.000000
1            2   22525763437723648  ...     -15.492200  0.000010
2            3                   0  ... -760877.000000  0.000000
3            4  297237712845406208  ...      -3.702320  0.000008
4            5  418835796137607168  ...      -6.573180  0.000009
...        ...                 ...  ...            ...       ...
120934  120935  445864815605317632  ...       6.293810  0.000018
120935  120936  900720956266250240  ...       1.328200  0.000007
120936  120937  238705348779704320  ...       0.731932  0.000009
120937  120938  373800349619716096  ...       0.800783  0.000007
120938  120939  238694972138717184  ...       5.503780  0.000021

[120939 rows x 9 columns] 

Applying DBSCANFilter to 29172 hits...
[DBSCAN] Separate hits into 127 groups.
DBSCANFilter complete and 3993 hits remained.

Start pairing between:
[(2, 4), (4, 6), (6, 8)]

Pairing between layer2(1066 hits) x layer4(966 hits)...
Applying TransverseMomentumFilter to 1029756 hit pairs...
TransverseMomentumFilter complete and 17510 pairs remained.

Applying ClusterEdgeFilter to 17510 hit pairs...
ClusterEdgeFilter complete and 4214 pairs remained.

Applying RealEdgeLabeler to 4214 hit pairs...
RealEdgeLabeler complete and 4214 pairs remained.

Pairing between layer4(966 hits) x layer6(999 hits)...
Applying TransverseMomentumFilter to 965034 hit pairs...
TransverseMomentumFilter complete and 16144 pairs remained.

Applying ClusterEdgeFilter to 16144 hit pairs...
ClusterEdgeFilter complete and 4334 pairs remained.

Applying RealEdgeLabeler to 4334 hit pairs...
RealEdgeLabeler complete and 4334 pairs remained.

Pairing between layer6(999 hits) x layer8(962 hits)...
Applying TransverseMomentumFilter to 961038 hit pairs...
TransverseMomentumFilter complete and 20014 pairs remained.

Applying ClusterEdgeFilter to 20014 hit pairs...
ClusterEdgeFilter complete and 5142 pairs remained.

Applying RealEdgeLabeler to 5142 hit pairs...
RealEdgeLabeler complete and 5142 pairs remained.

Node count: 3993. Edge count: 13690
0
0
11670
2020

Process finished with exit code 0
